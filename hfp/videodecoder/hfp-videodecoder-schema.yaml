# Pykwalify schema for video decoder capabilities
# Enforces codec-to-profile and profile-to-level mappings

type: map
mapping:
  videodecoder:
    type: map
    required: true
    mapping:
      interfaceVersion:
        type: str
        required: true
        pattern: '^\d+\.\d+\.\d+$'

      Capabilities:
        type: seq
        required: true
        sequence:
          - type: map
            matching: "any"
            mapping:
              regex;(^\d+$):
                type: map
                mapping:
                  codecCapabilities:
                    type: seq
                    required: true
                    sequence:
                      - type: map
                        mapping:
                          MPEG2_VIDEO:
                            type: map
                            mapping:
                              profiles:
                                type: seq
                                required: false
                                sequence:
                                  - type: map
                                    mapping:
                                      MPEG2_MAIN:
                                        type: map
                                        mapping:
                                          maxLevel:
                                            type: str
                                            required: true
                                            enum:
                                              [
                                                MPEG2_LEVEL_LOW,
                                                MPEG2_LEVEL_MAIN,
                                                MPEG2_LEVEL_HIGH,
                                              ]
                                          maxBitrateInBps:
                                            type: number
                                            required: true
                                      MPEG2_SIMPLE:
                                        type: map
                                        mapping:
                                          maxLevel:
                                            type: str
                                            required: true
                                            enum:
                                              [
                                                MPEG2_LEVEL_LOW,
                                                MPEG2_LEVEL_MAIN,
                                                MPEG2_LEVEL_HIGH,
                                              ]
                                          maxBitrateInBps:
                                            type: number
                                            required: true

                          H264_AVC:
                            type: map
                            mapping:
                              profiles:
                                type: seq
                                required: false
                                sequence:
                                  - type: map
                                    mapping:
                                      H264_BASELINE:
                                        type: map
                                        mapping:
                                          maxLevel:
                                            type: str
                                            required: true
                                            enum:
                                              [
                                                H264_LEVEL_3,
                                                H264_LEVEL_3_1,
                                                H264_LEVEL_4,
                                                H264_LEVEL_4_1,
                                                H264_LEVEL_5,
                                                H264_LEVEL_5_1,
                                                H264_LEVEL_5_2,
                                              ]
                                          maxBitrateInBps:
                                            type: number
                                            required: true
                                      H264_MAIN:
                                        type: map
                                        mapping:
                                          maxLevel:
                                            type: str
                                            required: true
                                            enum:
                                              [
                                                H264_LEVEL_3,
                                                H264_LEVEL_3_1,
                                                H264_LEVEL_4,
                                                H264_LEVEL_4_1,
                                                H264_LEVEL_5,
                                                H264_LEVEL_5_1,
                                                H264_LEVEL_5_2,
                                              ]
                                          maxBitrateInBps:
                                            type: number
                                            required: true
                                      H264_HIGH:
                                        type: map
                                        mapping:
                                          maxLevel:
                                            type: str
                                            required: true
                                            enum:
                                              [
                                                H264_LEVEL_3,
                                                H264_LEVEL_3_1,
                                                H264_LEVEL_4,
                                                H264_LEVEL_4_1,
                                                H264_LEVEL_5,
                                                H264_LEVEL_5_1,
                                                H264_LEVEL_5_2,
                                              ]
                                          maxBitrateInBps:
                                            type: number
                                            required: true

                          H265_HEVC:
                            type: map
                            mapping:
                              profiles:
                                type: seq
                                required: false
                                sequence:
                                  - type: map
                                    mapping:
                                      H265_MAIN:
                                        type: map
                                        mapping:
                                          maxLevel:
                                            type: str
                                            required: true
                                            enum:
                                              [
                                                H265_LEVEL_4,
                                                H265_LEVEL_4_1,
                                                H265_LEVEL_5,
                                                H265_LEVEL_5_1,
                                                H265_LEVEL_5_2,
                                                H265_LEVEL_6,
                                                H265_LEVEL_6_1,
                                                H265_LEVEL_6_2,
                                              ]
                                          maxBitrateInBps:
                                            type: number
                                            required: true
                                      H265_MAIN_10:
                                        type: map
                                        mapping:
                                          maxLevel:
                                            type: str
                                            required: true
                                            enum:
                                              [
                                                H265_LEVEL_4,
                                                H265_LEVEL_4_1,
                                                H265_LEVEL_5,
                                                H265_LEVEL_5_1,
                                                H265_LEVEL_5_2,
                                                H265_LEVEL_6,
                                                H265_LEVEL_6_1,
                                                H265_LEVEL_6_2,
                                              ]
                                          maxBitrateInBps:
                                            type: number
                                            required: true
                                      H265_MAIN_10_HDR10:
                                        type: map
                                        mapping:
                                          maxLevel:
                                            type: str
                                            required: true
                                            enum:
                                              [
                                                H265_LEVEL_4,
                                                H265_LEVEL_4_1,
                                                H265_LEVEL_5,
                                                H265_LEVEL_5_1,
                                                H265_LEVEL_5_2,
                                                H265_LEVEL_6,
                                                H265_LEVEL_6_1,
                                                H265_LEVEL_6_2,
                                              ]
                                          maxBitrateInBps:
                                            type: number
                                            required: true

                          VP9:
                            type: map
                            mapping:
                              profiles:
                                type: seq
                                required: false
                                sequence:
                                  - type: map
                                    mapping:
                                      VP9_PROFILE_0:
                                        type: map
                                        mapping:
                                          maxLevel:
                                            type: str
                                            required: true
                                            enum:
                                              [
                                                VP9_LEVEL_1,
                                                VP9_LEVEL_1_1,
                                                VP9_LEVEL_2,
                                                VP9_LEVEL_2_1,
                                                VP9_LEVEL_3,
                                                VP9_LEVEL_3_1,
                                                VP9_LEVEL_4,
                                                VP9_LEVEL_4_1,
                                                VP9_LEVEL_5,
                                                VP9_LEVEL_5_1,
                                                VP9_LEVEL_5_2,
                                                VP9_LEVEL_6,
                                                VP9_LEVEL_6_1,
                                                VP9_LEVEL_6_2,
                                              ]
                                          maxBitrateInBps:
                                            type: number
                                            required: true
                                      VP9_PROFILE_1:
                                        type: map
                                        mapping:
                                          maxLevel:
                                            type: str
                                            required: true
                                            enum:
                                              [
                                                VP9_LEVEL_1,
                                                VP9_LEVEL_1_1,
                                                VP9_LEVEL_2,
                                                VP9_LEVEL_2_1,
                                                VP9_LEVEL_3,
                                                VP9_LEVEL_3_1,
                                                VP9_LEVEL_4,
                                                VP9_LEVEL_4_1,
                                                VP9_LEVEL_5,
                                                VP9_LEVEL_5_1,
                                                VP9_LEVEL_5_2,
                                                VP9_LEVEL_6,
                                                VP9_LEVEL_6_1,
                                                VP9_LEVEL_6_2,
                                              ]
                                          maxBitrateInBps:
                                            type: number
                                            required: true
                                      VP9_PROFILE_2:
                                        type: map
                                        mapping:
                                          maxLevel:
                                            type: str
                                            required: true
                                            enum:
                                              [
                                                VP9_LEVEL_1,
                                                VP9_LEVEL_1_1,
                                                VP9_LEVEL_2,
                                                VP9_LEVEL_2_1,
                                                VP9_LEVEL_3,
                                                VP9_LEVEL_3_1,
                                                VP9_LEVEL_4,
                                                VP9_LEVEL_4_1,
                                                VP9_LEVEL_5,
                                                VP9_LEVEL_5_1,
                                                VP9_LEVEL_5_2,
                                                VP9_LEVEL_6,
                                                VP9_LEVEL_6_1,
                                                VP9_LEVEL_6_2,
                                              ]
                                          maxBitrateInBps:
                                            type: number
                                            required: true
                                      VP9_PROFILE_3:
                                        type: map
                                        mapping:
                                          maxLevel:
                                            type: str
                                            required: true
                                            enum:
                                              [
                                                VP9_LEVEL_1,
                                                VP9_LEVEL_1_1,
                                                VP9_LEVEL_2,
                                                VP9_LEVEL_2_1,
                                                VP9_LEVEL_3,
                                                VP9_LEVEL_3_1,
                                                VP9_LEVEL_4,
                                                VP9_LEVEL_4_1,
                                                VP9_LEVEL_5,
                                                VP9_LEVEL_5_1,
                                                VP9_LEVEL_5_2,
                                                VP9_LEVEL_6,
                                                VP9_LEVEL_6_1,
                                                VP9_LEVEL_6_2,
                                              ]
                                          maxBitrateInBps:
                                            type: number
                                            required: true

                          AV1:
                            type: map
                            mapping:
                              profiles:
                                type: seq
                                required: false
                                sequence:
                                  - type: map
                                    mapping:
                                      AV1_MAIN:
                                        type: map
                                        mapping:
                                          maxLevel:
                                            type: str
                                            required: true
                                            enum:
                                              [
                                                AV1_LEVEL_4_0,
                                                AV1_LEVEL_4_1,
                                                AV1_LEVEL_5_0,
                                                AV1_LEVEL_5_1,
                                                AV1_LEVEL_6_0,
                                                AV1_LEVEL_6_1,
                                              ]
                                          maxBitrateInBps:
                                            type: number
                                            required: true
                                      AV1_HIGH:
                                        type: map
                                        mapping:
                                          maxLevel:
                                            type: str
                                            required: true
                                            enum:
                                              [
                                                AV1_LEVEL_4_0,
                                                AV1_LEVEL_4_1,
                                                AV1_LEVEL_5_0,
                                                AV1_LEVEL_5_1,
                                                AV1_LEVEL_6_0,
                                                AV1_LEVEL_6_1,
                                              ]
                                          maxBitrateInBps:
                                            type: number
                                            required: true

                  dynamicRange:
                    type: seq
                    required: true
                    sequence:
                      - type: str
                        enum: [SDR, HLG, HDR10, HDR10PLUS, DOLBY_VISION]
